@using ADHDWebApp.Models
@{
    Layout = null;

    string FormatFileSize(long bytes)
    {
        string[] sizes = { "B", "KB", "MB", "GB" };
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="~/css/dashboard.css" rel="stylesheet" />
    <link rel="icon" href="~/images/logo.jpg" />

</head>
<body class="dashboard-page">


    <div class="modal fade" id="allNotificationsModal" tabindex="-1" aria-labelledby="allNotificationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="allNotificationsModalLabel">All Notifications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="all-notifications-list">
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-bell-slash fs-1"></i>
                        <p class="mt-2">No notifications yet.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="top-nav">
        <div class="left-nav d-flex align-items-center">
            <div class="site-logo me-3">
                <img src="~/images/logo.jpg" alt="ADHD Webapp Logo" style="height: 32px; width: auto;" />
            </div>
            <button class="nav-btn" type="button" data-bs-toggle="modal" data-bs-target="#helpModal">
                <i class="bi bi-question-circle"></i>
                <span>Help</span>
            </button>
        </div>
        <div class="nav-divider"></div>
        <div class="right-nav d-flex align-items-center">

            <div class="user-dropdown me-3">
                <button class="nav-btn" onclick="toggleDropdown('focus', event)">
                    <img src="~/images/focus icon.png" alt="Focus" style="width: 20px; height: 20px; object-fit: contain;" />
                    <span>Focus</span>
                </button>
                <div class="dropdown-menu enhanced-dropdown text-start" id="focus-dropdown" dir="ltr" style="direction:ltr;">
                    <div class="dropdown-header">
                        <i class="bi bi-bullseye"></i>
                        <span>Focus Tools</span>
                    </div>
                    <div class="dropdown-divider"></div>

                    <div class="activity-item" onclick="toggleInlinePanel('focus-music-panel', event)" style="cursor: pointer;">
                        <div class="activity-icon">
                            <i class="bi bi-music-note-beamed"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Focus Music</div>
                            <div class="activity-desc">Lofi, classical, nature sounds</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-brightness-high"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Breathing Exercises</div>
                            <div class="activity-desc">4-7-8 technique, box breathing</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-puzzle"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Mind Games</div>
                            <div class="activity-desc">Memory, puzzles, brain teasers</div>
                        </div>
                    </div>

                    <div class="inline-panel-host">
                        <div class="activity-item" onclick="toggleInlinePanel('focus-timer-panel', event)" style="cursor: pointer;">
                            <div class="activity-icon">
                                <i class="bi bi-stopwatch"></i>
                            </div>
                            <div class="activity-info">
                                <div class="activity-title">Timer</div>
                                <div class="activity-desc">Pomodoro and focus presets</div>
                            </div>
                        </div>
                    </div>

                    <!-- Timer panel positioned relative to Focus dropdown (top-left) -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-focus text-start" id="focus-timer-panel" dir="ltr" style="direction:ltr;">
                        <div class="dropdown-header">
                            <i class="bi bi-stopwatch"></i>
                            <span>Timer</span>
                        </div>
                        <div class="dropdown-divider"></div>

                        <div class="timer-options px-3">
                            <h6>Preset Timers:</h6>
                            <div>
                                <span class="timer-preset active" data-minutes="25">Pomodoro (25m)</span>
                                <span class="timer-preset" data-minutes="15">Short Break (15m)</span>
                                <span class="timer-preset" data-minutes="5">Quick Break (5m)</span>
                                <span class="timer-preset" data-minutes="50">Deep Focus (50m)</span>
                            </div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <div class="activity-item">
                            <div class="progress-ring">
                                <svg width="24" height="24">
                                    <circle class="progress-circle" r="10" cx="12" cy="12" fill="transparent" stroke="#e3f2fd" stroke-width="3"></circle>
                                    <circle class="progress-circle" r="10" cx="12" cy="12" fill="transparent" stroke="#00bcd4" stroke-width="3" stroke-dasharray="62.8" stroke-dashoffset="31.4"></circle>
                                </svg>
                            </div>
                            <div class="activity-info">
                                <div class="activity-title">Remaining Time</div>
                                <div class="activity-desc">25:00</div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="d-flex justify-content-around p-2">
                            <button class="btn btn-sm btn-success"><i class="bi bi-play"></i> Start</button>
                            <button class="btn btn-sm btn-danger"><i class="bi bi-pause"></i> Pause</button>
                            <button class="btn btn-sm btn-secondary"><i class="bi bi-arrow-clockwise"></i> Reset</button>
                        </div>
                    </div>

                    <!-- Focus Music panel positioned relative to Focus dropdown (top-left) -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-focus text-start" id="focus-music-panel" dir="ltr" style="direction:ltr;">
                        <div class="dropdown-header">
                            <i class="bi bi-music-note-beamed"></i>
                            <span>Focus Music</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="px-3 py-2">
                            <div class="mb-2">
                                <h6 class="mb-2">Presets</h6>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary" id="music-preset-quran">Quran</button>
                                    <button type="button" class="btn btn-outline-primary" id="music-preset-rain">Rain</button>
                                    <button type="button" class="btn btn-outline-primary" id="music-preset-earth">Earth</button>
                                    <button type="button" class="btn btn-outline-primary" id="music-preset-topone">Top One</button>
                                </div>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <button type="button" class="btn btn-success btn-sm me-2" id="music-toggle"><i class="bi bi-play-fill"></i> Play</button>
                                <div class="flex-grow-1">
                                    <input type="range" class="form-range" id="music-volume" min="0" max="1" step="0.01" value="0.6">
                                </div>
                            </div>
                            <div class="small text-muted">Now Playing: <span id="music-nowplaying">None</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Files Dropdown -->
            <div class="user-dropdown me-3">
                <button class="nav-btn" onclick="toggleDropdown('files', event)">
                    <img src="~/images/files icon.png" alt="Files" style="width: 20px; height: 20px; object-fit: contain;" />
                    <span>Files</span>
                </button>
                <div class="dropdown-menu enhanced-dropdown text-start" id="files-dropdown" dir="ltr" style="direction:ltr;">
                    <div class="dropdown-header">
                        <img src="~/images/folder icon.png" alt="File Management" class="helper-icon" style="width: 20px; height: 20px; object-fit: contain; margin-right: 0.5rem;" />
                        <span>File Management</span>
                    </div>
                    <div class="dropdown-divider"></div>

                    <!-- Upload New (نفس ستايل الباقي) -->
                    <div class="activity-item" onclick="document.getElementById('file-upload').click()" style="cursor: pointer;">
                        <div class="activity-icon text-primary">
                            <i class="bi bi-cloud-arrow-up"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Upload New</div>
                            <div class="activity-desc">PDF, DOCX, TXT, Images</div>
                        </div>
                    </div>

                    <div class="activity-item" onclick="showMyFiles();" style="cursor: pointer;">
                        <div class="activity-icon">
                            <i class="bi bi-collection"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">My Files</div>
                            <div class="activity-desc">12 files, 3 folders</div>
                        </div>
                    </div>

                    <div class="activity-item" onclick="showRecentFiles();" style="cursor: pointer;">
                        <div class="activity-icon">
                            <i class="bi bi-stars"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Recent Files</div>
                            <div class="activity-desc">lecture_notes.pdf, summary.docx</div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-share"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Shared With Me</div>
                            <div class="activity-desc">3 files from classmates</div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Tools Dropdown -->
            <div class="user-dropdown me-3">
                <button class="nav-btn" onclick="toggleDropdown('tools')">
                    <img src="~/images/tools icon.png" alt="Tools" style="width: 20px; height: 20px; object-fit: contain;" />
                    <span>Tools</span>
                </button>
                <div class="dropdown-menu enhanced-dropdown text-start" id="tools-dropdown" dir="ltr" style="direction:ltr;">
                    <div class="dropdown-header">
                        <i class="bi bi-tools"></i>
                        <span>Study Tools</span>
                    </div>
                    <div class="dropdown-divider"></div>

                    <div class="activity-item" onclick="toggleInlinePanel('tools-calculator-panel', event, 'tools-dropdown')" style="cursor: pointer;">
                        <div class="activity-icon text-info">
                            <img src="~/images/calculator.png" alt="Calculator" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Calculator</div>
                            <div class="activity-desc">Quick arithmetic calculator</div>
                        </div>
                    </div>
                    <div class="activity-item" onclick="toggleInlinePanel('tools-translation-panel', event, 'tools-dropdown')" style="cursor: pointer;">
                        <div class="activity-icon text-success">
                            <img src="~/images/translation.png" alt="Translation" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Translation</div>
                            <div class="activity-desc">Translate text to 40+ languages</div>
                        </div>
                    </div>

                    <div class="activity-item" onclick="toggleInlinePanel('tools-progress-panel', event, 'tools-dropdown')" style="cursor: pointer;">
                        <div class="activity-icon text-primary">
                            <img src="~/images/progress.png" alt="Progress" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Progress Tracker</div>
                            <div class="activity-desc">View your study analytics</div>
                        </div>
                    </div>

                    <div class="activity-item" onclick="toggleInlinePanel('tools-planner-panel', event, 'tools-dropdown')" style="cursor: pointer;">
                        <div class="activity-icon text-warning">
                            <img src="~/images/Study Planner.png" alt="Study Planner" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Study Planner</div>
                            <div class="activity-desc">Schedule your sessions</div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Calculator panel positioned relative to Tools dropdown (top-left) -->
            <div class="dropdown-menu enhanced-dropdown inline-left-from-tools text-start" id="tools-calculator-panel" dir="ltr" style="direction:ltr;">
                <div class="dropdown-header">
                    <i class="bi bi-calculator"></i>
                    <span>Calculator</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="px-3 py-2" style="width:300px;">
                    <input type="text" id="calc-display" class="form-control form-control-sm mb-2 text-end" placeholder="0" readonly />
                    <div class="btn-group w-100 mb-2" role="group">
                        <button class="btn btn-sm btn-outline-secondary flex-fill" data-calc-action="clear">C</button>
                        <button class="btn btn-sm btn-outline-secondary flex-fill" data-calc-action="back">←</button>
                        <button class="btn btn-sm btn-outline-secondary flex-fill" data-calc-input="(">(</button>
                        <button class="btn btn-sm btn-outline-secondary flex-fill" data-calc-input=")">)</button>
                    </div>
                    <div class="d-grid gap-2">
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="7">7</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="8">8</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="9">9</button>
                            <button class="btn btn-sm btn-outline-primary flex-fill" data-calc-input="/">÷</button>
                        </div>
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="4">4</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="5">5</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="6">6</button>
                            <button class="btn btn-sm btn-outline-primary flex-fill" data-calc-input="*">×</button>
                        </div>
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="1">1</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="2">2</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="3">3</button>
                            <button class="btn btn-sm btn-outline-primary flex-fill" data-calc-input="-">−</button>
                        </div>
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input="0">0</button>
                            <button class="btn btn-sm btn-light flex-fill" data-calc-input=".">.</button>
                            <button class="btn btn-sm btn-success flex-fill" data-calc-action="equals">=</button>
                            <button class="btn btn-sm btn-outline-primary flex-fill" data-calc-input="+">+</button>
                        </div>
                    </div>
                    <div class="small text-danger mt-2" id="calc-error" style="display:none;"></div>
                </div>
            </div>

            <div class="dropdown-menu enhanced-dropdown inline-left-from-tools text-start" id="tools-progress-panel" dir="ltr" style="direction:ltr;">
                <div class="dropdown-header">
                    <i class="bi bi-graph-up"></i>
                    <span>Progress Tracker</span>
                </div>
                <div class="dropdown-divider"></div>
                <div id="progress-tracker-panel" class="px-3 py-2" style="width:300px;">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-bar-chart"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Streak</div>
                            <div class="activity-desc" id="progress-streak">0 days</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-globe2"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Weekly Browsing Time</div>
                            <div class="activity-desc" id="progress-browsing">0h 0m this week</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-book"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Weekly Subjects Studied</div>
                            <div class="activity-desc" id="progress-subjects">0 subjects</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="bi bi-stopwatch"></i>
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Weekly Focus Minutes</div>
                            <div class="activity-desc" id="progress-focus">0 min</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Translation panel positioned relative to Tools dropdown (top-left) -->
            <div class="dropdown-menu enhanced-dropdown inline-left-from-tools text-start" id="tools-translation-panel" dir="ltr" style="direction:ltr;">
                <div class="dropdown-header">
                    <img src="~/images/translation.png" alt="Translation" class="helper-icon" style="width: 20px; height: 20px; object-fit: contain; margin-right: 0.5rem;" />
                    <span>Translation</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="px-3 py-2" style="width:320px;">
                    <div class="mb-3">
                        <label class="form-label small fw-medium">Text to translate:</label>
                        <textarea class="form-control form-control-sm" id="translation-input" rows="3" placeholder="Enter text here..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-medium">Target language:</label>
                        <select class="form-select form-select-sm" id="translation-target-lang">
                            <option value="ar">Arabic (العربية)</option>
                            <option value="en" selected>English</option>
                            <option value="es">Spanish (Español)</option>
                            <option value="fr">French (Français)</option>
                            <option value="de">German (Deutsch)</option>
                            <option value="it">Italian (Italiano)</option>
                            <option value="pt">Portuguese (Português)</option>
                            <option value="ru">Russian (Русский)</option>
                            <option value="ja">Japanese (日本語)</option>
                            <option value="ko">Korean (한국어)</option>
                            <option value="zh">Chinese (中文)</option>
                            <option value="tr">Turkish (Türkçe)</option>
                            <option value="hi">Hindi (हिन्दी)</option>
                        </select>
                    </div>
                    <button class="btn btn-primary btn-sm w-100 mb-2" id="translation-translate-btn">
                        <i class="bi bi-translate me-1"></i> Translate
                    </button>
                    <div class="mb-2" id="translation-result-container" style="display:none;">
                        <label class="form-label small fw-medium">Translation:</label>
                        <div class="p-2 border rounded bg-light small" id="translation-result" style="min-height: 60px; white-space: pre-wrap;"></div>
                    </div>
                    <div class="small text-danger" id="translation-error" style="display:none;"></div>
                </div>
            </div>

            <!-- Study Planner panel positioned relative to Tools dropdown (top-left) -->
            <div class="dropdown-menu enhanced-dropdown inline-left-from-tools text-start" id="tools-planner-panel" dir="ltr" style="direction:ltr;">
                <div class="dropdown-header">
                    <img src="~/images/Study Planner.png" alt="Study Planner" class="helper-icon" style="width: 20px; height: 20px; object-fit: contain; margin-right: 0.5rem;" />
                    <span>Study Planner</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="px-3 py-2" style="width:380px; max-height:500px; overflow-y:auto;">
                    <!-- Add Session Form -->
                    <div class="mb-3" id="planner-form-container">
                        <button class="btn btn-primary btn-sm w-100 mb-2" id="planner-toggle-form-btn">
                            <i class="bi bi-plus-lg me-1"></i> Add New Session
                        </button>
                        <div id="planner-form" class="d-none">
                            <div class="mb-2">
                                <input type="text" class="form-control form-control-sm" id="planner-title" placeholder="Main title *" required />
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control form-control-sm" id="planner-subject" placeholder="Subtitle (optional)" />
                            </div>
                            <div class="mb-2">
                                <input type="date" class="form-control form-control-sm" id="planner-date" required />
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success btn-sm flex-fill" id="planner-save-btn">
                                    <i class="bi bi-check-lg"></i> Save
                                </button>
                                <button class="btn btn-secondary btn-sm" id="planner-cancel-btn">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Sessions -->
                    <div class="mb-3">
                        <h6 class="small fw-bold text-muted mb-2">Upcoming Sessions</h6>
                        <div id="planner-upcoming-list" class="d-flex flex-column gap-2">
                            <div class="text-muted small text-center py-2">No upcoming sessions</div>
                        </div>
                    </div>

                    <!-- Completed Sessions -->
                    <div>
                        <h6 class="small fw-bold text-muted mb-2">Completed Sessions</h6>
                        <div id="planner-completed-list" class="d-flex flex-column gap-2">
                            <div class="text-muted small text-center py-2">No completed sessions</div>
                        </div>
                    </div>
                </div>
                <div class="small text-danger px-3 pb-2" id="planner-error" style="display:none;"></div>
            </div>


            <!-- User dropdown -->
            <div class="user-dropdown">
                <button class="nav-btn user-btn" onclick="toggleDropdown('user')">
                    @if (!string.IsNullOrEmpty(ViewBag.AvatarUrl as string))
                    {
                        <img src="@ViewBag.AvatarUrl" alt="Avatar" class="rounded-circle me-1" style="width:24px;height:24px;object-fit:cover;" />
                    }
                    else
                    {
                        <i class="bi bi-person-circle me-1"></i>
                    }
                    <span>@ViewBag.FullName</span>
                    <i class="bi bi-chevron-down ms-1"></i>
                </button>
                <div class="dropdown-menu enhanced-dropdown text-start" id="user-dropdown" data-user-id="@ViewBag.UserId" dir="ltr" style="direction:ltr;">
                    <div class="dropdown-header">
                        <i class="bi bi-person-circle"></i>
                        <span>@ViewBag.FullName</span>
                    </div>
                    <div class="dropdown-divider"></div>

                    <div class="activity-item" onclick="toggleInlinePanel('profile-panel', event)" style="cursor: pointer;">
                        <div class="activity-icon">
                            <img src="~/images/profile icon.png" alt="Profile" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Profile</div>
                            <div class="activity-desc">View and edit your profile</div>
                        </div>
                    </div>


                    <div class="activity-item" onclick="openClassesInlinePanel(event)" style="cursor: pointer;">
                        <div class="activity-icon text-primary">
                            <img src="~/images/Classes icon.png" alt="Classes" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Classes</div>
                            <div class="activity-desc">Manage and join your classes</div>
                        </div>
                    </div>

                    <!-- Notifications Button -->
                    <div class="activity-item" onclick="toggleNotificationsPanel(event)" style="cursor: pointer;">
                        <div class="activity-icon text-warning">
                            <img src="~/images/Notifications icon.png" alt="Notifications" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Notifications</div>
                            <div class="activity-desc">View your notifications</div>
                        </div>
                    </div>

                    <!-- Messages Button -->
                    <div class="activity-item" onclick="toggleInlinePanel('messages-panel', event)" style="cursor: pointer;">
                        <div class="activity-icon text-info">
                            <img src="~/images/Messages icon.png" alt="Messages" style="width: 20px; height: 20px; object-fit: contain;" />
                        </div>
                        <div class="activity-info">
                            <div class="activity-title">Messages</div>
                            <div class="activity-desc">View your messages</div>
                        </div>
                    </div>

                    <!-- Notifications Panel -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="notifications-panel" dir="ltr" style="direction:ltr; min-width: 360px; max-height: 85vh;">
                        <div class="notifications-banner"></div>
                        <div class="notifications-content px-4 pb-4">
                            <div class="notifications-header-icon shadow-sm d-flex align-items-center justify-content-center bg-white text-warning mb-3">
                                <i class="bi bi-bell-fill fs-4"></i>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold">Notifications</h5>
                                <a href="#" class="small text-primary" onclick="event.preventDefault(); markAllAsRead()">Mark all read</a>
                            </div>

                            <div id="notifications-list" class="notifications-list" style="max-height: 400px; overflow-y: auto;">
                                <div class="text-center text-muted py-5">
                                    <i class="bi bi-bell-slash fs-1 mb-3 d-block"></i>
                                    <p class="mb-1 fw-medium">No notifications</p>
                                    <small class="text-muted">You're all caught up!</small>
                                </div>
                            </div>
                            
                            <div class="text-center mt-3 pt-3 border-top">
                                <a href="#" class="small text-primary fw-medium" data-bs-toggle="modal" data-bs-target="#allNotificationsModal">
                                    View all notifications <i class="bi bi-arrow-right ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Panel -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="messages-panel" dir="ltr" style="direction:ltr; min-width: 380px; max-height: 85vh;">
                        <div class="messages-banner"></div>
                        <div class="messages-content px-4 pb-4">
                            <div class="messages-header-icon shadow-sm d-flex align-items-center justify-content-center bg-white text-primary mb-3">
                                <i class="bi bi-chat-dots fs-4"></i>
                            </div>
                            
                            <h5 class="text-center mb-4 fw-bold">Class Messages</h5>

                            <div class="mb-3">
                                <label class="small text-muted mb-2 ms-1">Select Class</label>
                                <div class="input-group input-group-sm">
                                    <select id="chat-class-select" class="form-select rounded-pill-start"></select>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill-end px-3" id="chat-refresh-btn" title="Refresh">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                            </div>

                            <div id="chat-area" class="border rounded-3 p-3 bg-light" style="display:none; max-height: 250px; overflow-y: auto; min-height: 120px;">
                                <div class="text-center text-muted py-5" id="chat-empty">
                                    <i class="bi bi-chat-left-text fs-1 mb-3 d-block"></i>
                                    <p class="mb-1 fw-medium">No messages yet</p>
                                    <small class="text-muted">Select a class to start chatting</small>
                                </div>
                                <ul class="list-group list-group-flush" id="class-chat-list" style="display:none;"></ul>
                            </div>

                            <div class="mt-3">
                                <div class="input-group">
                                    <input type="text" class="form-control rounded-pill-start" id="chat-input" placeholder="Type a message..." />
                                    <button type="button" class="btn btn-primary rounded-pill-end px-4" id="chat-send-btn">
                                        <img src="~/images/send icon.png" alt="Send" style="width: 18px; height: 18px; object-fit: contain;" />
                                    </button>
                                </div>
                                <div class="small text-danger mt-2" id="chat-error" style="display:none;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Network Panel -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="classes-panel" dir="ltr" style="direction:ltr; min-width: 320px;">
                        <div class="classes-banner"></div>
                        <div class="classes-content px-4 pb-4">
                            <div class="classes-header-icon shadow-sm d-flex align-items-center justify-content-center bg-white text-primary mb-3">
                                <img src="~/images/class icon.png" alt="Classes" style="width: 32px; height: 32px; object-fit: contain;" />
                            </div>
                            
                            <h5 class="text-center mb-4 fw-bold">My Classes</h5>

                            <div id="network-classes-content">
                                @if ((ViewBag.Role as string) != "Teacher")
                                {
                                    <div class="mb-3">
                                        <label class="small text-muted mb-1 ms-1">Join a Class</label>
                                        <div class="input-group input-group-sm">
                                            <input type="text" class="form-control rounded-pill-start" id="classes-join-code" placeholder="Enter code">
                                            <button class="btn btn-primary rounded-pill-end px-3" id="classes-join-btn">
                                                <i class="bi bi-arrow-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                }
                                @if ((ViewBag.Role as string) != "Student")
                                {
                                    <div class="mb-3">
                                        <label class="small text-muted mb-1 ms-1">Create New Class</label>
                                        <div class="input-group input-group-sm">
                                            <input type="text" class="form-control rounded-pill-start" id="classes-add-name" placeholder="Class name">
                                            <button class="btn btn-secondary rounded-pill-end px-3" id="classes-add-btn">
                                                <i class="bi bi-plus-lg"></i>
                                            </button>
                                        </div>
                                    </div>
                                }
                                <div class="mt-4">
                                    <ul class="list-group list-group-flush gap-2" id="classes-list"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Class Details Panel (opens near user dropdown) -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="class-details-panel" dir="ltr" style="direction:ltr; min-width: 340px; max-height: 85vh;" data-width="340">
                        <div class="class-details-banner"></div>
                        <div class="class-details-content px-4 pb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <button class="btn btn-sm btn-link text-muted p-0" onclick="document.getElementById('class-details-panel').classList.remove('show'); toggleInlinePanel('classes-panel', event)" title="Back to Classes">
                                    <i class="bi bi-arrow-left fs-5"></i>
                                </button>
                                <div class="class-details-header-icon shadow-sm d-flex align-items-center justify-content-center bg-white text-primary">
                                    <img src="~/images/class icon.png" alt="Class Details" style="width: 32px; height: 32px; object-fit: contain;" />
                                </div>
                                <div style="width: 24px;"></div> <!-- Spacer for centering -->
                            </div>
                            
                            <div class="text-center mb-4">
                                <h5 id="cls-title" class="fw-bold mb-1">Class Name</h5>
                                <span id="cls-code" class="badge bg-light text-dark border">Code</span>
                            </div>

                            <div class="cls-tabs mb-4">
                                <div class="nav nav-pills nav-fill gap-2 p-1 bg-light rounded-3" role="tablist">
                                    <button class="nav-link active btn-sm py-1 small fw-medium" data-tab="info" onclick="window.__setClassDetailsActiveTab && window.__setClassDetailsActiveTab('info')">Info</button>
                                    <button class="nav-link btn-sm py-1 small fw-medium" data-tab="options" onclick="window.__setClassDetailsActiveTab && window.__setClassDetailsActiveTab('options')">Options</button>
                                </div>
                            </div>

                            <div class="cls-tabs-content">
                                <!-- Information Tab -->
                                <div class="cls-tab-pane active" id="cls-tab-info">
                                    <div class="row g-2 mb-3">
                                        <div class="col-6">
                                            <div class="cls-stat-card p-2 border rounded-3 text-center bg-white shadow-sm" onclick="toggleInlinePanel('cls-members-panel', event)" style="cursor: pointer;">
                                                <div class="h5 m-0 fw-bold text-primary" id="cls-stat-students">0</div>
                                                <div class="small text-muted">Students <i class="bi bi-chevron-right" style="font-size: 0.7em;"></i></div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="cls-stat-card p-2 border rounded-3 text-center bg-white shadow-sm" onclick="toggleInlinePanel('cls-files-panel', event)" style="cursor: pointer;">
                                                <div class="h5 m-0 fw-bold text-secondary" id="cls-stat-files">0</div>
                                                <div class="small text-muted">Files <i class="bi bi-chevron-right" style="font-size: 0.7em;"></i></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="cls-section mb-3">
                                        <div class="cls-section-title small text-uppercase text-muted mb-2 fw-bold">Teacher</div>
                                        <div class="cls-teacher-card d-flex align-items-center gap-3 p-2 border rounded-3 bg-white">
                                            <div class="cls-teacher-avatar bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                <i class="bi bi-person-badge"></i>
                                            </div>
                                            <div id="cls-teacher" class="small fw-medium flex-grow-1">Loading...</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Options Tab -->
                                <div class="cls-tab-pane d-none" id="cls-tab-options">
                                    <div class="cls-section mb-3">
                                        <div class="cls-section-title small text-uppercase text-muted mb-2 fw-bold">Analytics & Tools</div>
                                        <div class="d-flex flex-column gap-2 mb-3">
                                             <button type="button" class="btn btn-sm btn-outline-primary w-100 rounded-pill text-start px-3" onclick="alert('Overall analytics coming soon')">
                                                <i class="bi bi-graph-up-arrow"></i> Overall Student Analytics
                                            </button>
                                             <!-- For Teachers -->
                                             @if ((ViewBag.Role as string) == "Teacher")
                                             {
                                                 <button type="button" class="btn btn-sm btn-outline-secondary w-100 rounded-pill text-start px-3" onclick="alert('Class settings coming soon')">
                                                    <i class="bi bi-gear"></i> Class Settings
                                                 </button>
                                                 <button type="button" class="btn btn-sm btn-outline-secondary w-100 rounded-pill text-start px-3" onclick="alert('Export report coming soon')">
                                                    <i class="bi bi-file-earmark-spreadsheet"></i> Export Participation
                                                 </button>
                                             }
                                             <!-- For Students -->
                                             @if ((ViewBag.Role as string) == "Student")
                                             {
                                                 <button type="button" class="btn btn-sm btn-outline-secondary w-100 rounded-pill text-start px-3" onclick="alert('Teacher contact coming soon')">
                                                    <i class="bi bi-envelope"></i> Contact Teacher
                                                 </button>
                                                 <button type="button" class="btn btn-sm btn-outline-secondary w-100 rounded-pill text-start px-3" onclick="alert('My performance coming soon')">
                                                    <i class="bi bi-speedometer2"></i> My Performance
                                                 </button>
                                             }
                                        </div>
                                        
                                        <div class="cls-section-title small text-uppercase text-muted mb-2 fw-bold">Management</div>
                                        <div class="d-flex flex-column gap-2">
                                            <button type="button" id="delete-class-btn" class="btn btn-sm btn-danger w-100 rounded-pill text-start px-3" style="display:none;">
                                                <i class="bi bi-trash"></i> Leave and Delete Class
                                            </button>
                                            <button type="button" id="leave-class-btn" class="btn btn-sm btn-outline-danger w-100 rounded-pill text-start px-3" style="display:none;">
                                                <i class="bi bi-box-arrow-left"></i> Leave Class
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Members Panel (Inline from Class Details button) -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="cls-members-panel" dir="ltr" style="direction:ltr; min-width: 300px;" data-width="320">
                        <div class="dropdown-header d-flex justify-content-between align-items-center">
                            <button class="btn btn-sm btn-link text-muted p-0" onclick="document.getElementById('cls-members-panel').classList.remove('show'); toggleInlinePanel('class-details-panel', event)" title="Back to Class Details"><i class="bi bi-arrow-left fs-5"></i></button>
                            <span><i class="bi bi-people me-2"></i>Class Members</span>
                            <div style="width: 24px;"></div>
                        </div>
                        <div class="dropdown-divider m-0"></div>
                        <div class="p-0" style="max-height: 400px; overflow-y: auto;">
                            <!-- Search/Filter can go here -->
                            <ul id="cls-members-list" class="list-group list-group-flush small"></ul>
                        </div>
                    </div>

                    <!-- Files Panel (Inline from Class Details button) -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="cls-files-panel" dir="ltr" style="direction:ltr; min-width: 320px;" data-width="360">
                        <div class="dropdown-header d-flex justify-content-between align-items-center">
                            <button class="btn btn-sm btn-link text-muted p-0" onclick="document.getElementById('cls-files-panel').classList.remove('show'); toggleInlinePanel('class-details-panel', event)" title="Back to Class Details"><i class="bi bi-arrow-left fs-5"></i></button>
                            <span><i class="bi bi-folder me-2"></i>Class Files</span>
                            <button class="btn btn-sm btn-link text-primary p-0" onclick="if(typeof loadClassFiles === 'function' && window.__currentClassId) loadClassFiles(window.__currentClassId);" title="Refresh"><i class="bi bi-arrow-clockwise"></i></button>
                        </div>
                        <div class="dropdown-divider m-0"></div>
                        <div class="p-3" style="max-height: 400px; overflow-y: auto;">
                             <div id="cls-files-upload" class="mb-3" style="display:none;">
                                <div class="input-group input-group-sm">
                                    <input type="file" class="form-control rounded-pill-start" id="cls-file-upload" />
                                    <button class="btn btn-primary rounded-pill-end px-3" type="button" id="cls-upload-btn">
                                        <i class="bi bi-cloud-arrow-up"></i>
                                    </button>
                                </div>
                                <div class="text-danger small mt-1" id="cls-files-error" style="display:none;"></div>
                            </div>
                            <div id="cls-files-grid" class="d-grid gap-2" style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));">
                                <!-- Files rendered here as cards -->
                            </div>
                            <ul id="cls-files" class="list-group list-group-flush small border rounded-3 overflow-hidden d-none"></ul>
                        </div>
                    </div>

                    <!-- Profile Panel -->
                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start p-0 overflow-hidden" id="profile-panel" dir="ltr" style="direction:ltr; min-width: 320px;">
                        <div class="profile-banner"></div>
                        <div class="profile-content text-center px-4 pb-4">
                            <div class="profile-avatar-wrapper mb-3">
                                @if (ViewBag.AvatarUrl != null)
                                {
                                    <img src="@ViewBag.AvatarUrl" alt="Profile" class="profile-avatar-large shadow-sm" />
                                }
                                else
                                {
                                    <div class="profile-avatar-large shadow-sm d-flex align-items-center justify-content-center bg-white text-primary">
                                        <i class="bi bi-person-fill fs-1"></i>
                                    </div>
                                }
                            </div>
                            
                            <h5 class="mb-1 fw-bold">@ViewBag.Username</h5>
                            <p class="text-muted small mb-3">@ViewBag.Role • ID: @ViewBag.UserId</p>

                            <div class="profile-stats d-flex justify-content-center gap-4 mb-4">
                                <div class="profile-stat-item">
                                    <div class="h5 mb-0 fw-bold text-primary">0</div>
                                    <div class="small text-muted">Streak</div>
                                </div>
                                <div class="profile-stat-item">
                                    <div class="h5 mb-0 fw-bold text-primary">
                                        @if (ViewBag.UserFiles != null)
                                        {
                                            @(((List<UserFile>)ViewBag.UserFiles).Count)
                                        }
                                        else
                                        {
                                            <text>0</text>
                                        }
                                    </div>
                                    <div class="small text-muted">Files</div>
                                </div>
                                <div class="profile-stat-item">
                                    <div class="h5 mb-0 fw-bold text-primary">
                                        @if (ViewBag.UserClasses != null)
                                        {
                                            @(((List<Class>)ViewBag.UserClasses).Count)
                                        }
                                        else
                                        {
                                            <text>0</text>
                                        }
                                    </div>
                                    <div class="small text-muted">Classes</div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <form asp-controller="Dashboard" asp-action="UpdateDateOfBirth" method="post" class="mb-2">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text bg-white"><i class="bi bi-calendar"></i></span>
                                        <input type="date" name="dob" class="form-control" value="@(ViewBag.DateOfBirth?.ToString("yyyy-MM-dd"))" onchange="this.form.submit()" title="Change Date of Birth" />
                                    </div>
                                </form>

                                <form asp-controller="Dashboard" asp-action="UploadAvatar" method="post" enctype="multipart/form-data">
                                    <input type="file" name="avatar" id="avatar-upload" class="d-none" onchange="this.form.submit()" />
                                    <button type="button" class="btn btn-outline-primary btn-sm w-100 rounded-pill" onclick="document.getElementById('avatar-upload').click()">
                                        <i class="bi bi-camera me-2"></i>Change Photo
                                    </button>
                                </form>
                                <form asp-controller="Account" asp-action="Delete" method="post" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm w-100 rounded-pill">
                                        <i class="bi bi-trash me-2"></i>Delete Account
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start" id="settings-panel" dir="ltr" style="direction:ltr;">
                        <div class="dropdown-header">
                            <i class="bi bi-gear"></i>
                            <span>Settings</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="px-3 py-2">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="setting-darkmode">
                                <label class="form-check-label" for="setting-darkmode">Dark Mode</label>
                            </div>
                            <div class="mb-2">
                                <label class="form-label small">Language</label>
                                <select class="form-select form-select-sm">
                                    <option selected>English</option>
                                    <option>Arabic</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dropdown-divider"></div>
                    <a href="/Account/Logout" class="dropdown-item text-center">
                        Logout <i class="bi bi-box-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="left-side">
            <div class="doc-box">
                <div class="left-content">
                  
                    <div id="left-top-actions" class="p-3 d-flex align-items-center justify-content-center">
                        <div class="d-flex gap-3" style="max-width:720px;">
                            <div class="upload-card text-center flex-fill" style="cursor:pointer;" onclick="document.getElementById('file-upload').click()">
                                <div class="upload-icon">
                                    <img src="~/images/upload.png" alt="Upload file" class="helper-icon" />
                                </div>
                                <h5>Upload File</h5>
                            </div>
                            <div class="upload-card text-center flex-fill" style="cursor:pointer;" onclick="startEmptyDocument()">
                                <div class="upload-icon">
                                    <img src="~/images/startempty.png" alt="Start empty document" class="helper-icon" />
                                </div>
                                <h5>Start Empty</h5>
                            </div>
                        </div>
                        <div id="upload-inline-error" class="text-danger small ms-3">@TempData["InlineError"]</div>
                    </div>

                    
                    <form id="uploadForm" method="post" enctype="multipart/form-data" asp-controller="Dashboard" asp-action="UploadDocument">
                        <input type="file" id="file-upload" name="file" class="d-none" accept=".txt,.docx,.pdf,.png,.jpg,.jpeg,.gif" onchange="if (handleFileSelection(this)) document.getElementById('uploadForm').submit();">
                        <div id="file-info" class="upload-info mt-2"></div>
                    </form>

                    
                    <div id="uploaded-files-section" class="mt-1" style="display: block">
                            <div id="uploaded-files-container" class="uploaded-files-container">
                            <div id="files-manage-bar" class="d-flex justify-content-between align-items-center mb-2">
                                <div class="d-flex align-items-center gap-3"></div>
                                <div class="d-flex align-items-center gap-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary btn-back" data-action="back" onclick="exitGroupView()">
                                        <i class="bi bi-arrow-left"></i> Back
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-danger" id="btn-delete-group" style="display:none;" onclick="deleteCurrentGroup()">
                                        <i class="bi bi-folder-x"></i> Delete Group
                                    </button>
                                    <button type="button" class="btn btn-sm btn-secondary" id="btn-group-files" style="display:none;" onclick="groupSelectedFiles()">
                                        <i class="bi bi-collection"></i> Add folder
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger" id="btn-delete-files" style="display:none;" onclick="deleteSelectedFiles()">
                                        <i class="bi bi-trash"></i> Delete
                                    </button>
                                </div>
                            </div>

                            <h6 class="files-section-title mb-2 d-flex align-items-center gap-2">
                                <img src="~/images/files icon.png" alt="Files" style="width: 20px; height: 20px; object-fit: contain;" />
                                <span id="uploaded-files-title-text">Your Recent Files</span>
                            </h6>

                            @if (ViewBag.UserFiles != null && ((List<UserFile>)ViewBag.UserFiles).Any())
                            {
                                <div class="files-grid">
                                    @foreach (var file in ((List<UserFile>)ViewBag.UserFiles).OrderByDescending(f => f.UploadedAt))
                                    {
                                        <div class="file-card" onclick="openFile(@file.Id)" data-file-id="@file.Id" data-uploaded-at="@file.UploadedAt.Ticks">
                                            <div class="form-check" style="position: absolute; top: 8px; left: 8px; z-index: 2;">
                                                <input class="form-check-input file-select-checkbox" type="checkbox" data-file-id="@file.Id" onclick="event.stopPropagation();" onchange="onFileCheckboxChange(this)">
                                            </div>
                                            <div class="file-icon-large d-flex align-items-center justify-content-center">
                                                <img src="~/images/file.png" alt="File" style="width: 36px; height: 36px; object-fit: contain;" />
                                            </div>
                                            <div class="file-name-card">@file.FileName</div>
                                            <div class="file-meta-card">
                                                <small class="text-muted">
                                                    @{
                                                        var sizeText = file.FileSize.HasValue ? FormatFileSize(file.FileSize.Value) : "Unknown size";
                                                    }
                                                    @sizeText
                                                </small>
                                            </div>
                                            <div class="file-actions">
                                                <button class="file-action-btn btn-delete-file" onclick="deleteFile(@file.Id, event)" title="Delete">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="no-files-message text-center py-3">
                                    <img src="~/images/folder icon.png" alt="No files" class="mb-2" style="width: 40px; height: 40px; object-fit: contain; opacity: 0.6;" />
                                    <p class="text-muted mb-1">No files uploaded yet</p>
                                    <small class="text-muted">Upload your first file above</small>
                                </div>
                            }
                        </div>
                    </div>

                    
                    <div id="manual-text" style="display: none;" class="p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="m-0">Manual Text Input</h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="toggleTextInput()">
                                <i class="bi bi-x"></i> Cancel
                            </button>
                        </div>
                        <textarea class="form-control mb-3" style="min-height: 200px"
                                  placeholder="Type or paste your content here..."></textarea>
                        <div class="text-end">
                            <button class="btn btn-primary" onclick="submitManualText()">
                                <i class="bi bi-send"></i> Submit Text
                            </button>
                        </div>
                    </div>


                
                    <div id="file-display-container" style="display: none" class="d-flex flex-column h-100 pt-2">
                        <div class="controls-bar d-flex align-items-center gap-2">
                            <button onclick="resetUpload()" class="btn btn-primary btn-sm">
                                <i class="bi bi-arrow-left me-1"></i>
                                Back
                            </button>
                            
                            <button type="button" class="btn btn-sm btn-outline-secondary action-btn" onclick="toggleDarkMode()" data-bs-toggle="tooltip" title="Hide Text">
                                <i class="bi bi-eye-slash"></i>
                            </button>

                            <div class="dropdown d-inline-block">
                                <button class="btn btn-sm btn-outline-secondary rounded-pill dropdown-toggle no-caret d-inline-flex align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-toggle="tooltip" title="Options">
                                    <i class="bi bi-sliders me-1"></i><span class="d-none d-sm-inline">Options</span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end custom-dropdown">
                                    <li class="dropdown-header">Text Settings</li>
                                    <li>
                                        <button class="dropdown-item" onclick="adjustFontSize('increase')">
                                            <i class="bi bi-zoom-in me-2"></i>Increase Font Size
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" onclick="adjustFontSize('decrease')">
                                            <i class="bi bi-zoom-out me-2"></i>Decrease Font Size
                                        </button>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li class="dropdown-header">Alignment</li>
                                    <li>
                                        <button class="dropdown-item" onclick="setTextAlign('left')">
                                            <i class="bi bi-text-left me-2"></i>Align Left
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" onclick="setTextAlign('center')">
                                            <i class="bi bi-text-center me-2"></i>Align Center
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" onclick="setTextAlign('right')">
                                            <i class="bi bi-text-right me-2"></i>Align Right
                                        </button>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li class="dropdown-header">Layout</li>
                                    <li>
                                        <button class="dropdown-item" onclick="toggleLineHeight()">
                                            <i class="bi bi-text-spacing me-2"></i>Toggle Line Spacing
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" onclick="toggleReadingMode()">
                                            <i class="bi bi-book me-2"></i>Reading Mode
                                        </button>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li class="dropdown-header">File Actions</li>
                                    <li>
                                        <button class="dropdown-item" onclick="downloadContent()">
                                            <i class="bi bi-download me-2"></i>Download
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" onclick="shareContent()">
                                            <i class="bi bi-share me-2"></i>Share
                                        </button>
                                    </li>
                                </ul>
                            </div>
                            <div class="flex-grow-1 text-center">
                                <span class="filename-display fw-medium">@(ViewBag.FileName ?? TempData["FileName"])</span>
                            </div>
                            <div class="ms-auto d-flex gap-3 align-items-center">
                                <div id="word-count" class="text-muted small">
                                    <i class="bi bi-hash me-1"></i>0 words
                                </div>
                                <div id="read-time" class="text-muted small">
                                    <i class="bi bi-clock me-1"></i>0 min read
                                </div>
                            </div>
                        </div>
                        <hr class="divider my-2">
                        <div class="document-content flex-grow-1 bg-white pt-2">
                            <div id="content-wrapper">
                                <div id="content-display" class="content-text mb-0">@(ViewBag.UploadedText ?? TempData["UploadedText"])</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>



        <div class="right-side">
            <div class="doc-box">
                <div class="left-content" style="position: relative;">
                    <div id="generate-wrapper" class="d-flex flex-column align-items-center justify-content-center" style="min-height: 70vh; display: flex;">
                    <div id="btn-generate-ai-helper" class="upload-card mb-3" style="cursor: pointer; width: 260px;">
                        <div class="upload-icon">
                            <img src="~/images/helpertools.png" alt="Helper tools" class="helper-icon">
                        </div>
                        <h5>Study Tools</h5>
                        <p class="text-muted small">Open to choose what to generate</p>
                    </div>
                    <div id="generate-options" class="w-100" style="max-width: 720px; display: none;">
                        <div class="row w-100">
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-summary" style="cursor:pointer;" onclick="window.summarizeLeftToRight && window.summarizeLeftToRight(); return false;">
                                    <div class="upload-icon"><img src="~/images/summary.png" alt="Summary icon" class="helper-icon"></div>
                                    <h5>Summary</h5>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-workbook" style="cursor:pointer;">
                                    <div class="upload-icon"><img src="~/images/flashcard.png" alt="Flashcards icon" class="helper-icon"></div>
                                    <h5>Flashcards</h5>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-quizzes" style="cursor:pointer;">
                                    <div class="upload-icon"><img src="~/images/quizzes.png" alt="Quizzes icon" class="helper-icon"></div>
                                    <h5>Quizzes</h5>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-notes" style="cursor:pointer;">
                                    <div class="upload-icon"><img src="~/images/notes.png" alt="Notes icon" class="helper-icon"></div>
                                    <h5>Notes</h5>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-ai" style="cursor:pointer;">
                                    <div class="upload-icon"><img src="~/images/youtube.png" alt="YouTube icon" class="helper-icon"></div>
                                    <h5>Add Video</h5>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 mb-3">
                                <div class="upload-card text-center" id="gen-opt-audio" style="cursor:pointer;">
                                    <div class="upload-icon">
                                        <img src="/images/audio icon.png" alt="Add Audio" style="width: 48px; height: 48px;">
                                    </div>
                                    <h5>Add Audio</h5>
                                </div>
                            </div>
                            
                            </div>
                        </div>
                    </div>

                    <!-- Summary right-pane view -->
                    <div id="summary-display-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10;" class="h-100 pt-2">
                        <div class="controls-bar" style="position: relative; z-index: 100;">
                            <div class="d-flex align-items-center justify-content-between gap-2">
                                <div class="d-flex align-items-center gap-2">
                                    <button onclick="window.backFromSummaryRight && window.backFromSummaryRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        Back
                                    </button>

                                    <div class="dropdown d-inline-block">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle no-caret d-inline-flex align-items-center tool-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-toggle="tooltip" title="Options">
                                            <i class="bi bi-sliders me-1"></i>Options
                                        </button>
                                        <ul class="dropdown-menu custom-dropdown text-start" style="right: auto; left: 0;">
                                            <li class="dropdown-header">Text Settings</li>
                                            <li>
                                                <button class="dropdown-item" onclick="adjustFontSize('increase')">
                                                    <i class="bi bi-zoom-in me-2"></i>Increase Font Size
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item" onclick="adjustFontSize('decrease')">
                                                    <i class="bi bi-zoom-out me-2"></i>Decrease Font Size
                                                </button>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li class="dropdown-header">Alignment</li>
                                            <li>
                                                <button class="dropdown-item" onclick="setTextAlign('left')">
                                                    <i class="bi bi-text-left me-2"></i>Align Left
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item" onclick="setTextAlign('center')">
                                                    <i class="bi bi-text-center me-2"></i>Align Center
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item" onclick="setTextAlign('right')">
                                                    <i class="bi bi-text-right me-2"></i>Align Right
                                                </button>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li class="dropdown-header">Layout</li>
                                            <li>
                                                <button class="dropdown-item" onclick="toggleLineHeight()">
                                                    <i class="bi bi-text-spacing me-2"></i>Toggle Line Spacing
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item" onclick="toggleReadingMode()">
                                                    <i class="bi bi-book me-2"></i>Reading Mode
                                                </button>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li class="dropdown-header">File Actions</li>
                                            <li>
                                                <button class="dropdown-item" onclick="downloadContent()">
                                                    <i class="bi bi-download me-2"></i>Download
                                                </button>
                                            </li>
                                            <li>
                                                <button class="dropdown-item" onclick="shareContent()">
                                                    <i class="bi bi-share me-2"></i>Share
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex-grow-1 text-center tool-header-title overflow-hidden px-2">
                                    <span id="summary-filename-display" class="filename-display fw-medium text-truncate d-block">Summary</span>
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <div id="summary-stats" class="d-flex gap-2 me-1 text-muted small d-none d-md-flex">
                                        <span id="summary-word-count"><i class="bi bi-hash me-1"></i>0 words</span>
                                        <span id="summary-read-time"><i class="bi bi-clock me-1"></i>0 min</span>
                                    </div>

                                    <button type="button" class="btn btn-sm btn-outline-secondary tool-btn" onclick="toggleDarkMode()" data-bs-toggle="tooltip" title="Hide Text">
                                        <i class="bi bi-eye-slash me-1"></i>Hide
                                    </button>

                                    <button type="button"
                                            id="summary-reload-btn"
                                            class="btn btn-sm btn-outline-primary tool-btn"
                                            onclick="window.summarizeLeftToRight && window.summarizeLeftToRight();"
                                            title="Reload summary">
                                        <i class="bi bi-arrow-repeat me-1"></i>Reload
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2">

                        <div class="document-content flex-grow-1 bg-white pt-2">
                            <div id="summary-content-wrapper">
                                <div id="summary-content-display" class="content-text mb-0"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Flashcards right-pane view -->
                    <div id="flashcards-display-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10;" class="h-100 pt-2">
                        <div class="controls-bar" style="position: relative; z-index: 100;">
                            <div class="d-flex align-items-center justify-content-between gap-2">
                                <div class="d-flex align-items-center">
                                    <button onclick="window.backFromFlashcardsRight && window.backFromFlashcardsRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        Back
                                    </button>
                                </div>

                                <div class="flex-grow-1 text-center tool-header-title overflow-hidden px-2">
                                    <span id="flashcards-title" class="filename-display fw-medium text-truncate d-block">Flashcards</span>
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <div id="flashcards-count" class="text-muted small me-2 d-none d-sm-inline">
                                        <i class="bi bi-collection me-1"></i>0 cards
                                    </div>
                                    <button type="button" class="btn btn-success btn-sm tool-btn" id="flashcards-add-toggle">
                                        <i class="bi bi-plus-circle me-1"></i>
                                        Add
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2" />

                        <div class="document-content flex-grow-1 bg-white pt-2 d-flex flex-column">
                            <div id="flashcards-content" class="flex-grow-1 d-flex flex-column align-items-center text-center px-3">

                                <div id="flashcard-create-container" class="w-100" style="max-width: 480px; display:none;">
                                    <div class="mb-3 text-start">
                                        <label for="flashcard-new-question" class="form-label mb-1">Question</label>
                                        <textarea id="flashcard-new-question" class="form-control" rows="2" placeholder="Enter question..."></textarea>
                                    </div>
                                    <div class="mb-2 text-start">
                                        <label for="flashcard-new-answer" class="form-label mb-1">Answer</label>
                                        <textarea id="flashcard-new-answer" class="form-control" rows="3" placeholder="Enter answer..."></textarea>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <small id="flashcard-create-error" class="text-danger"></small>
                                        <button type="button" class="btn btn-sm btn-success" id="flashcard-add-btn">Add Flashcard</button>
                                    </div>
                                </div>

                                <div id="flashcard-card" class="flashcard-card">
                                    <div class="flashcard-progress small text-muted mb-2">
                                        <span id="flashcard-index">1</span>/<span id="flashcard-total">1</span>
                                    </div>
                                    <div class="flashcard-body">
                                        <div id="flashcard-question" class="flashcard-question mb-3">
                                            Flashcard question will appear here.
                                        </div>
                                        <div id="flashcard-answer" class="flashcard-answer d-none">
                                            Flashcard answer will appear here.
                                        </div>
                                    </div>
                                    <div class="flashcard-actions mt-3 d-flex justify-content-between">
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="prevFlashcard()">Previous</button>
                                        <button type="button" class="btn btn-primary btn-sm" id="flashcard-toggle-btn" onclick="toggleFlashcardAnswer()">Show answer</button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="nextFlashcard()">Next</button>
                                    </div>
                                </div>
                                <div id="flashcards-empty-state" class="empty-state d-none">
                                    <i class="bi bi-card-text"></i>
                                    <p>No flashcards available.</p>
                                    <small>Click "Add" to create your first flashcard.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quizzes right-pane view -->
                    <div id="quizzes-display-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10;" class="h-100 pt-2">
                        <div class="controls-bar" style="position: relative; z-index: 100;">
                            <div class="d-flex align-items-center justify-content-between gap-2">
                                <div class="d-flex align-items-center">
                                    <button onclick="window.backFromQuizzesRight && window.backFromQuizzesRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        Back
                                    </button>
                                </div>

                                <div class="flex-grow-1 text-center tool-header-title overflow-hidden px-2">
                                    <span id="quizzes-title" class="filename-display fw-medium text-truncate d-block">Quizzes</span>
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <button type="button" class="btn btn-success btn-sm tool-btn" id="quizzes-add-toggle">
                                        <i class="bi bi-plus-circle me-1"></i>
                                        Add
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2">

                        <div id="quizzes-content" class="flex-grow-1 d-flex flex-column">
                            <!-- Quiz Creation Form (hidden by default) -->
                            <div id="quiz-creation-form" class="d-none mb-3">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Create New Quiz Question</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Question:</label>
                                            <textarea id="quiz-question" class="form-control" rows="2" placeholder="Enter your question here..."></textarea>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Options:</label>
                                            <div class="mb-2">
                                                <input type="text" id="quiz-option-a" class="form-control" placeholder="Option A" />
                                            </div>
                                            <div class="mb-2">
                                                <input type="text" id="quiz-option-b" class="form-control" placeholder="Option B" />
                                            </div>
                                            <div class="mb-2">
                                                <input type="text" id="quiz-option-c" class="form-control" placeholder="Option C" />
                                            </div>
                                            <div class="mb-2">
                                                <input type="text" id="quiz-option-d" class="form-control" placeholder="Option D" />
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Correct Answer:</label>
                                            <select id="quiz-correct-answer" class="form-select">
                                                <option value="">Select correct answer</option>
                                                <option value="A">Option A</option>
                                                <option value="B">Option B</option>
                                                <option value="C">Option C</option>
                                                <option value="D">Option D</option>
                                            </select>
                                        </div>
                                        
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-primary" onclick="saveQuizQuestion()">Save Question</button>
                                            <button type="button" class="btn btn-secondary" onclick="cancelQuizCreation()">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quiz Display -->
                            <div id="quiz-display" class="flex-grow-1 d-flex flex-column">
                                <div class="quiz-card mx-auto" style="max-width: 600px; width: 100%;">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="quiz-header mb-3">
                                                <span class="badge bg-primary">Question <span id="quiz-current-number">1</span> of <span id="quiz-total-count">0</span></span>
                                            </div>
                                            <div class="quiz-question mb-4">
                                                <h5 id="quiz-display-question">Quiz question will appear here.</h5>
                                            </div>
                                            <div class="quiz-options mb-4">
                                                <div class="list-group">
                                                    <button type="button" class="list-group-item list-group-item-action quiz-option" data-option="A" onclick="selectQuizAnswer('A')">
                                                        <div class="d-flex align-items-center">
                                                            <span class="badge bg-secondary me-2">A</span>
                                                            <span id="quiz-option-a-text">Option A text</span>
                                                        </div>
                                                    </button>
                                                    <button type="button" class="list-group-item list-group-item-action quiz-option" data-option="B" onclick="selectQuizAnswer('B')">
                                                        <div class="d-flex align-items-center">
                                                            <span class="badge bg-secondary me-2">B</span>
                                                            <span id="quiz-option-b-text">Option B text</span>
                                                        </div>
                                                    </button>
                                                    <button type="button" class="list-group-item list-group-item-action quiz-option" data-option="C" onclick="selectQuizAnswer('C')">
                                                        <div class="d-flex align-items-center">
                                                            <span class="badge bg-secondary me-2">C</span>
                                                            <span id="quiz-option-c-text">Option C text</span>
                                                        </div>
                                                    </button>
                                                    <button type="button" class="list-group-item list-group-item-action quiz-option" data-option="D" onclick="selectQuizAnswer('D')">
                                                        <div class="d-flex align-items-center">
                                                            <span class="badge bg-secondary me-2">D</span>
                                                            <span id="quiz-option-d-text">Option D text</span>
                                                        </div>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="quiz-result mb-3 d-none" id="quiz-result">
                                                <div class="alert" id="quiz-result-alert">
                                                    <span id="quiz-result-text"></span>
                                                </div>
                                            </div>
                                            <div class="quiz-actions d-flex justify-content-between">
                                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="previousQuiz()">Previous</button>
                                                <button type="button" class="btn btn-primary btn-sm" id="quiz-submit-btn" onclick="submitQuizAnswer()">Submit Answer</button>
                                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="nextQuiz()">Next</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="quizzes-empty-state" class="empty-state d-none">
                                    <i class="bi bi-question-circle"></i>
                                    <p>No quizzes available.</p>
                                    <small>Click "Add" to create your first quiz question.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes right-pane view -->
                    <div id="notes-display-container" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10;" class="h-100 pt-2">
                        <div class="controls-bar" style="position: relative; z-index: 100;">
                            <div class="d-flex align-items-center justify-content-between gap-2">
                                <div class="d-flex align-items-center gap-2">
                                    <button onclick="window.backFromNotesRight && window.backFromNotesRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        Back
                                    </button>

                                    <div class="dropdown d-inline-block">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle no-caret d-inline-flex align-items-center tool-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Options">
                                            <i class="bi bi-sliders me-1"></i>Options
                                        </button>
                                        <ul class="dropdown-menu custom-dropdown p-3 text-start" style="min-width: 250px; right: auto; left: 0; z-index: 1050;">
                                            <li class="dropdown-header">Drawing Settings</li>
                                            <li class="mb-3 d-flex align-items-center justify-content-between">
                                                <label class="form-label small mb-0">Color</label>
                                                <input type="color" id="whiteboard-color" class="form-control form-control-color form-control-sm" value="#111827" title="Drawing color" />
                                            </li>
                                            <li class="mb-3">
                                                <label class="form-label small mb-1">Brush Size</label>
                                                <input type="range" id="whiteboard-line-width" class="form-range" min="1" max="12" value="2" />
                                            </li>
                                            <li class="mb-3">
                                                <label class="form-label small mb-1">Drawing Opacity</label>
                                                <input type="range" id="drawing-opacity" class="form-range" min="10" max="100" value="100" />
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li class="dropdown-header">Text Settings</li>
                                            <li class="mb-3">
                                                <label class="form-label small mb-1">Text Size</label>
                                                <input type="range" id="text-size" class="form-range" min="12" max="48" value="16" />
                                            </li>
                                            <li>
                                                <label class="form-label small mb-1">Text Opacity</label>
                                                <input type="range" id="text-opacity" class="form-range" min="10" max="100" value="100" />
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex-grow-1 text-center tool-header-title overflow-hidden px-2">
                                    <span id="notes-title" class="filename-display fw-medium text-truncate d-block">Notes</span>
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <button type="button" class="btn btn-sm btn-outline-info tool-btn" id="toggle-notes-mode" onclick="toggleNotesMode()" title="Toggle between writing and drawing">
                                        <i class="bi bi-pencil me-1"></i>Draw
                                    </button>

                                    <button type="button" class="btn btn-sm btn-outline-secondary tool-btn" id="eraser-toggle" title="Toggle eraser mode">
                                        <i class="bi bi-eraser-fill me-1"></i>Eraser
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2">

                        <div id="notes-content" class="flex-grow-1 d-flex flex-column align-items-center px-3" style="overflow-y: auto; max-height: calc(100vh - 200px);">
                            <!-- Combined white interface for both writing and drawing -->
                            <div class="w-100 position-relative" style="max-width: 100%; min-height: 500px; background-color: #ffffff;">
                                <!-- Text area for notes (always visible) -->
                                <textarea id="notes-textarea" class="form-control" placeholder="Write your notes here..." style="resize: none; width: 100%; height: 500px; border: none; outline: none; background-color: transparent; position: absolute; top: 0; left: 0; z-index: 1;"></textarea>
                                
                                <!-- Canvas for drawing (always visible on top) -->
                                <canvas id="whiteboard-canvas" style="width: 100%; height: 500px; position: absolute; top: 0; left: 0; z-index: 2; background-color: transparent; pointer-events: auto;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Audio right-pane view -->
                    <div id="audio-display-container" style="display: none;" class="h-100 pt-2">
                        <div class="controls-bar">
                            <div class="d-flex gap-2 align-items-center">
                                <button onclick="window.backFromAudioRight && window.backFromAudioRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                    <i class="bi bi-arrow-left me-1"></i>
                                    Back
                                </button>

                                <div class="flex-grow-1 text-center tool-header-title">
                                    <span id="audio-title" class="filename-display fw-medium">Audio Notes</span>
                                </div>

                                <div class="ms-auto d-flex gap-2 align-items-center">
                                    <button type="button" class="btn btn-sm btn-success tool-btn" id="save-audio-btn" onclick="saveCurrentAudio()" title="Save audio to your files" style="display: none;">
                                        <i class="bi bi-download me-1"></i>Save
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2" />

                        <div class="document-content flex-grow-1 bg-white pt-2 d-flex flex-column align-items-center">
                            <div class="text-center p-4 w-100">
                                <div class="mb-4">
                                    <div class="d-flex justify-content-center gap-4 align-items-center">
                                        <button id="audio-record-btn" class="btn btn-lg btn-danger rounded-circle p-4 shadow-sm" style="width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center;">
                                            <img src="/images/audio icon.png" alt="Record" style="width: 32px; height: 32px;">
                                        </button>
                                        
                                        <div class="text-center">
                                            <input type="file" id="audio-upload-input" accept="audio/*" style="display: none;" onchange="handleAudioUpload(event)" />
                                            <button id="audio-upload-btn" class="btn btn-lg btn-primary rounded-circle p-4 shadow-sm" style="width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center;" onclick="document.getElementById('audio-upload-input').click()">
                                                <img src="/images/updoad audio.png" alt="Upload Audio" style="width: 32px; height: 32px;">
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 text-muted fw-medium" id="audio-status">Click to Record or Upload</div>
                                    <div class="mt-1 fs-3 font-monospace" id="audio-timer">00:00</div>
                                </div>
                                
                                <div class="card shadow-sm mx-auto" style="max-width: 450px;">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-collection-play me-2"></i>Recordings</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="audio-list-container" class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                                            <div class="text-center py-4 text-muted small">
                                                <img src="/images/audio icon.png" alt="No recordings" style="width: 32px; height: 32px; opacity: 0.5;" class="d-block mb-2">
                                                No recordings yet
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Audio Player Area (hidden by default) -->
                                <div id="audio-player-container" class="w-100" style="display: none;">
                                    <div class="card shadow-sm mx-auto" style="max-width: 450px;">
                                        <div class="card-body p-3">
                                            <audio id="audio-player" controls style="width: 100%;">
                                                Your browser does not support the audio element.
                                            </audio>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video right-pane view -->
                    <div id="video-display-container" style="display: none;" class="h-100 pt-2">
                        <div class="controls-bar">
                            <div class="d-flex gap-2 align-items-center">
                                <button onclick="window.backFromVideoRight && window.backFromVideoRight(); return false;" class="btn btn-primary btn-sm tool-btn">
                                    <i class="bi bi-arrow-left me-1"></i>
                                    Back
                                </button>

                                <div class="flex-grow-1 text-center tool-header-title">
                                    <span id="video-title" class="filename-display fw-medium">Video Notes</span>
                                </div>

                                <div class="ms-auto d-flex gap-2 align-items-center">
                                    <button type="button" class="btn btn-sm btn-success tool-btn" id="save-video-btn" onclick="saveCurrentVideo()" title="Save video to your files" style="display: none;">
                                        <i class="bi bi-download me-1"></i>Save
                                    </button>
                                </div>
                            </div>
                        </div>

                        <hr class="divider my-2" />

                        <div class="document-content flex-grow-1 bg-white pt-2 d-flex flex-column align-items-center">
                            <!-- Video Player Area (hidden by default) -->
                            <div id="video-player-container" class="w-100 h-100" style="display: none;">
                                <video id="video-player" controls style="width: 100%; height: 100%; min-height: 400px; display: none;" class="rounded">
                                    Your browser does not support the video tag.
                                </video>
                                <iframe id="youtube-player" style="width: 100%; height: 100%; min-height: 400px; display: none; border: none;" class="rounded" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            
                            <!-- Upload Area (shown by default) -->
                            <div id="video-upload-area" class="text-center p-4 w-100">
                                <div class="mb-4">
                                    <div class="d-flex justify-content-center gap-4 align-items-center">
                                        <div class="text-center">
                                            <input type="file" id="video-upload-input" accept="video/*" style="display: none;" onchange="handleVideoUpload(event)" />
                                            <button id="video-upload-btn" class="btn btn-lg btn-primary rounded-circle p-4 shadow-sm" style="width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center;" onclick="document.getElementById('video-upload-input').click()">
                                                <img src="/images/upload.png" alt="Upload" style="width: 32px; height: 32px;">
                                            </button>
                                            <div class="mt-2 text-muted small">Upload Video</div>
                                        </div>
                                        
                                        <div class="text-center">
                                            <button id="video-youtube-btn" class="btn btn-lg btn-danger rounded-circle p-4 shadow-sm" style="width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center;" onclick="showYouTubeInput()">
                                                <img src="/images/youtube.png" alt="YouTube" style="width: 32px; height: 32px;">
                                            </button>
                                            <div class="mt-2 text-muted small">YouTube</div>
                                        </div>
                                    </div>
                                    <div class="mt-3 text-muted fw-medium" id="video-status">Upload video from device or add from YouTube</div>
                                </div>
                                
                                <!-- YouTube URL Input (hidden by default) -->
                                <div id="youtube-input-container" class="card shadow-sm mx-auto" style="max-width: 450px; display: none;">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-youtube me-2"></i>Add YouTube Video</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <input type="url" id="youtube-url-input" class="form-control" placeholder="Enter YouTube URL..." />
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary flex-grow-1" onclick="addYouTubeVideo()">Add Video</button>
                                            <button class="btn btn-secondary" onclick="hideYouTubeInput()">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card shadow-sm mx-auto" style="max-width: 450px;">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="bi bi-collection-play me-2"></i>Videos</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <div id="video-list-container" class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                                            <div class="text-center py-4 text-muted small">
                                                <img src="/images/youtube.png" alt="No videos" style="width: 32px; height: 32px; opacity: 0.5;" class="d-block mb-2">
                                                No videos yet
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-navigation">
        <button class="arrow-btn"><i class="bi bi-chevron-left"></i></button>
        <button class="arrow-btn"><i class="bi bi-chevron-right"></i></button>
    </div>

    
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-2">Use the right panel to generate new content:</p>
                    <ul class="mb-0">
                        <li>Generate new Summary</li>
                        <li>Flashcards</li>
                        <li>Generate Quizzes</li>
                        <li>Ask AI</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    
    <div class="modal fade" id="addNetworkModal" tabindex="-1" aria-labelledby="addNetworkModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addNetworkModalLabel">Add Network</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="add-network-form">
                        <div class="mb-3">
                            <label for="addresseeIdInput" class="form-label">User ID</label>
                            <input type="number" class="form-control" id="addresseeIdInput" placeholder="Enter user ID" required />
                            <div class="form-text">Enter the numeric ID of the user you want to add.</div>
                        </div>
                        <div id="add-network-feedback" class="small"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="send-friend-request-btn" onclick="sendFriendRequest()">Send Request</button>
                </div>
            </div>
        </div>
    </div>

    <div class="dropdown-menu enhanced-dropdown inline-left-from-user text-start" id="network-add-panel" style="z-index: 1100; direction:ltr;" dir="ltr">
        <div class="dropdown-header">
            <i class="bi bi-people"></i>
            <span>My Network</span>
        </div>
        <div class="dropdown-divider"></div>
        <div class="px-3 py-2">
            <div id="network-inline-loading" class="text-muted small mb-2" style="display:none;">Loading...</div>
            <div id="network-inline-error" class="text-danger small mb-2" style="display:none;"></div>

            <div class="mb-3">
                <h6 class="mb-2">Friends</h6>
                <ul class="list-group" id="network-inline-friends"></ul>
            </div>
            <div class="mb-3">
                <h6 class="mb-2">Incoming Requests</h6>
                <ul class="list-group" id="network-inline-incoming"></ul>
            </div>
            <div class="mb-3">
                <h6 class="mb-2">Outgoing Requests</h6>
                <ul class="list-group" id="network-inline-outgoing"></ul>
            </div>
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-sm btn-secondary" onclick="toggleInlinePanel('network-viewall-panel', event)">Close</button>
            </div>
        </div>
    </div>

    <script>
        window.DASHBOARD_CFG = {
            getFileContentUrl: '@Url.Action("GetFileContent", "Dashboard")'
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/dashboard.js"></script>
    <script src="~/js/planner.js"></script>
</body>
</html>